---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: authelia-secret
spec:
  target:
    template:
      type: Opaque
      data:
        AUTHELIA_AUTHENTICATION_BACKEND_LDAP_PASSWORD: "{{ .LLDAP_LDAP_USER_PASS }}"
        AUTHELIA_IDENTITY_PROVIDERS_OIDC_ISSUER_PRIVATE_KEY: "{{ .AUTHELIA_IDENTITY_PROVIDERS_OIDC_ISSUER_PRIVATE_KEY }}"
        AUTHELIA_IDENTITY_VALIDATION_RESET_PASSWORD_JWT_SECRET: "{{ .AUTHELIA_JWT_SECRET }}"
        AUTHELIA_SESSION_SECRET: "{{ .AUTHELIA_SESSION_SECRET }}"
        AUTHELIA_STORAGE_ENCRYPTION_KEY: "{{ .AUTHELIA_STORAGE_ENCRYPTION_KEY }}"
        AUTHELIA_STORAGE_POSTGRES_DATABASE: &dbName authelia
        AUTHELIA_STORAGE_POSTGRES_ADDRESS: &dbHost postgres16-rw.database.svc.cluster.local
        AUTHELIA_STORAGE_POSTGRES_USERNAME: &dbUser "{{ .AUTHELIA_STORAGE_POSTGRES_USERNAME }}"
        AUTHELIA_STORAGE_POSTGRES_PASSWORD: &dbPass "{{ .AUTHELIA_STORAGE_POSTGRES_PASSWORD }}"
        GRAFANA_OAUTH_CLIENT_SECRET: "{{ .GRAFANA_OAUTH_CLIENT_SECRET_HASHED }}"
        MINIFLUX_OAUTH_CLIENT_SECRET: "{{ .MINIFLUX_OAUTH_CLIENT_SECRET_HASHED }}"
        WEAVE_GITOPS_OAUTH_CLIENT_SECRET: "{{ .WEAVE_GITOPS_OAUTH_CLIENT_SECRET_HASHED }}"
        INIT_POSTGRES_DBNAME: *dbName
        INIT_POSTGRES_HOST: *dbHost
        INIT_POSTGRES_USER: *dbUser
        INIT_POSTGRES_PASS: *dbPass
        INIT_POSTGRES_SUPER_PASS: "{{ .POSTGRES_SUPER_PASS }}"
  data:
    - secretKey: LLDAP_LDAP_USER_PASS
      sourceRef:
        storeRef:
          name: bitwarden-login
          kind: ClusterSecretStore
      remoteRef:
        key: f1e4cecb-b66f-4a4d-a4ec-b0d701371995
        property: password
    - secretKey: AUTHELIA_IDENTITY_PROVIDERS_OIDC_ISSUER_PRIVATE_KEY
      sourceRef:
        storeRef:
          name: bitwarden-notes
          kind: ClusterSecretStore
      remoteRef:
        key: 1e08c2e1-3e88-44f2-9341-b0d7013e352b
    - secretKey: AUTHELIA_JWT_SECRET
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: 1e08c2e1-3e88-44f2-9341-b0d7013e352b
        property: AUTHELIA_JWT_SECRET
    - secretKey: AUTHELIA_SESSION_SECRET
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: 1e08c2e1-3e88-44f2-9341-b0d7013e352b
        property: AUTHELIA_SESSION_SECRET
    - secretKey: AUTHELIA_STORAGE_ENCRYPTION_KEY
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: 1e08c2e1-3e88-44f2-9341-b0d7013e352b
        property: AUTHELIA_STORAGE_ENCRYPTION_KEY
    - secretKey: AUTHELIA_STORAGE_POSTGRES_USERNAME
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: 1e08c2e1-3e88-44f2-9341-b0d7013e352b
        property: AUTHELIA_STORAGE_POSTGRES_USERNAME
    - secretKey: AUTHELIA_STORAGE_POSTGRES_PASSWORD
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: 1e08c2e1-3e88-44f2-9341-b0d7013e352b
        property: AUTHELIA_STORAGE_POSTGRES_PASSWORD
    - secretKey: POSTGRES_SUPER_PASS
      sourceRef:
        storeRef:
          name: bitwarden-login
          kind: ClusterSecretStore
      remoteRef:
        key: 7061dd7f-9099-441d-a06d-b0d70073aee1
        property: password
    - secretKey: GRAFANA_OAUTH_CLIENT_SECRET_HASHED
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: 289900d9-b227-4735-9ff0-b0d8014c14b9
        property: GRAFANA_OAUTH_CLIENT_SECRET_HASHED
    - secretKey: MINIFLUX_OAUTH_CLIENT_SECRET_HASHED
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: d91abd93-f917-4fc4-b723-b0dc01813d42
        property: MINIFLUX_OAUTH_CLIENT_SECRET_HASHED
    - secretKey: WEAVE_GITOPS_OAUTH_CLIENT_SECRET_HASHED
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: 2be4164b-8ee3-4438-ae6f-b0de014ff7d1
        property: WEAVE_GITOPS_OAUTH_CLIENT_SECRET_HASHED
