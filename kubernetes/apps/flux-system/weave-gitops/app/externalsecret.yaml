---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: cluster-user-auth # weave-gitops expects this name
spec:
  target:
    template:
      type: Opaque
      data:
        username: admin
        password: "{{ .WEAVE_GITOPS_ADMIN_PASSWORD_HASHED }}"
  data:
    - secretKey: WEAVE_GITOPS_ADMIN_PASSWORD_HASHED
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: 2be4164b-8ee3-4438-ae6f-b0de014ff7d1
        property:  WEAVE_GITOPS_ADMIN_PASSWORD_HASHED
---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: oidc-auth # weave-gitops expects this name
spec:
  target:
    template:
      type: Opaque
      data:
        clientID: weave-gitops
        clientSecret: "{{ .WEAVE_GITOPS_OAUTH_CLIENT_SECRET }}"
        issuerURL: https://auth.perryhuynh.com
        redirectURL: https://gitops.perryhuynh.com/oauth2/callback
        customScopes: openid,profile,email,groups
        claimGroups: groups
        claimUsername: preferred_username
  data:
    - secretKey: WEAVE_GITOPS_OAUTH_CLIENT_SECRET
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: 2be4164b-8ee3-4438-ae6f-b0de014ff7d1
        property: WEAVE_GITOPS_OAUTH_CLIENT_SECRET
